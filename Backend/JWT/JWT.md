JWT

# 目錄

- [目錄](#目錄)
- [什麼是 JWT](#什麼是-jwt)
- [設計目的](#設計目的)
- [JWT 的結構](#jwt-的結構)
- [JWT 的應用場景](#jwt-的應用場景)
- [JWT 的優缺點](#jwt-的優缺點)
  - [優點](#優點)
  - [缺點](#缺點)
- [相關連結](#相關連結)

# 什麼是 JWT

JWT 是一種在網路應用之間安全傳遞信息的開放標準[RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519), 通常使用於身份驗證及非敏感數據的傳輸

# 設計目的

提供一種安全且緊湊的方式來在網路上傳輸信息，以滿足身份驗證和授權等場景的需求。

JWT 的設計目的可以總結如下:

1. 跨域通信：JWT 允許在不同域之間進行安全通信。它可以作爲 HTTP 請求頭部或 URL 參數傳遞，使跨域請求變得更加方便。
2. 無狀態性：JWT 是自包含的，包括所有必要的信息。服務器不需要在會話中存儲任何信息，因此不需要維護會話狀態，這有助於提高應用程序的可伸縮性。
3. 安全性：JWT 使用數字簽名或加密來保護令牌的完整性。只有持有正確密鑰的人才能生成有效的令牌，從而確保令牌不會被篡改。
4. 靈活性：JWT 支持自定義聲明（claims），可以包含各種有關用戶或實體的信息。這使得 JWT 適用於各種應用場景，包括身份驗證、授權、單點登錄（SSO）等。
5. 簡化客戶端驗證：JWT 可以簡化客戶端驗證，因爲客戶端可以使用令牌的內容來獲取用戶信息，而無需再次查詢服務器。
6. 緊湊性：JWT 的格式緊湊，可以輕鬆地在 HTTP 請求中傳遞。這對於移動應用程序和單頁應用程序等前端應用程序來說尤其重要。
7. 標準化：JWT 是一個開放標準，廣泛使用於各種編程語言和平臺，因此具有廣泛的互操作性。

JWT 最常見的用途包括用戶身份驗證和授權，但它也可以用於其他方面，如安全重置密碼、令牌交換、單點登錄、電子簽名等。總之，JWT 的設計目的是提供一種通用的、安全的令牌格式，以滿足不同應用場景的需求，並簡化了跨域通信和無狀態應用程序的實現。

# JWT 的結構

JSON Web Token（JWT）的結構非常簡單，它由三個部分組成，這三個部分都是 Base64 編碼的字符串，使用點號（.）分隔開來。這三個部分分別是：Header（頭部）、Payload（負載）和 Signature（簽名）。

1.  Header（頭部）：頭部通常包含了兩個部分：令牌的類型（typ）和所使用的簽名算法（alg）。頭部是一個 JSON 對象，例如：
    ```json
    {
      "alg": "HS256",
      "typ": "JWT"
    }
    ```
    在上面的示例中，alg 表示使用 HS256 算法進行簽名，typ 表示令牌的類型爲 JWT。
2.  Payload（負載）：負載包含了一組聲明（claims），聲明是有關實體（通常是用戶）和其他數據的信息。負載也是一個 JSON 對象，包含了預定義的標準聲明和自定義聲明。JWT 的標準聲明包括：

            iss（issuer）：令牌的發行者。
            sub（subject）：令牌的主題，通常是用戶的唯一標識符。
            aud（audience）：令牌的受衆。
            exp（expiration time）：令牌的過期時間。
            nbf（not before）：令牌的生效時間。
            iat（issued at）：令牌的發行時間。
            jti（JWT ID）：JWT 的唯一標識符。

            自定義聲明可以根據需要添加，例如用戶角色、權限等信息。

    以下是 payload 的範例:

    ```json
    {
      "sub": "1234567890", // 主題（Subject），通常是用戶的唯一標識符
      "name": "charles", // 用戶名
      "iat": 1516239022, // 令牌的發行時間（Issued At）
      "exp": 1516239122 // 令牌的過期時間（Expiration Time）
    }
    ```

3.  Signature（簽名）：簽名部分用於驗證令牌的完整性和真實性。它是通過將 Base64 編碼的頭部和負載與密鑰進行簽名計算而生成的。簽名確保令牌在傳輸過程中沒有被篡改。

    完整的 JWT 結構如下：

    ```
    [Header].[Payload].[Signature]
    ```

    要驗證 JWT 的有效性，接收方將首先對頭部和負載進行 Base64 解碼，並使用與令牌的簽名算法相同的密鑰對其進行簽名計算，然後與接收到的簽名進行比較。如果簽名匹配且令牌沒有過期，那麼令牌被視爲有效。

    請注意，JWT 的結構是標準的，但頭部和負載的內容可以根據需要進行自定義，只需確保簽名算法和密鑰的一致性。密鑰的保密性非常重要，因爲泄漏密鑰可能導致令牌被僞造。

# JWT 的應用場景

1. 用戶身份驗證：JWT 通常用於用戶登錄和身份驗證。用戶在登錄成功後會收到一個包含用戶信息的 JWT 令牌，然後在後續請求中將令牌包含在請求頭部，服務器使用 JWT 驗證用戶身份。
2. 單點登錄（SSO）：JWT 可用於實現單點登錄系統，其中用戶只需登錄一次，然後可以訪問多個關聯的應用程序而無需重新登錄。JWT 可以包含有關用戶的信息，以便不同應用程序共享身份驗證信息。
3. 授權和訪問控制：JWT 可以包含用戶的角色、權限和其他聲明信息，服務器可以根據這些信息控制用戶對資源的訪問。這在 API 和微服務的訪問控制中特別有用。
4. 密碼重置和電子郵件確認：JWT 可以用於生成具有短期有效性的令牌，用於密碼重置、電子郵件確認和其他驗證場景。用戶點擊包含 JWT 的鏈接後，服務器驗證 JWT 並執行相應操作。
5. 移動應用程序身份驗證：JWT 可用於移動應用程序中的身份驗證，減少了與傳統會話管理相關的複雜性。
6. 安全令牌交換：JWT 可以用於安全令牌交換，允許客戶端以安全的方式獲取訪問令牌，以訪問受保護的資源。OAuth 2.0 和 OpenID Connect 等協議中廣泛使用 JWT。
7. 跨域通信：JWT 可以在不同域之間進行安全通信，因爲它可以輕鬆地在 HTTP 請求的頭部中傳遞，用於實現跨域請求。
8. 日誌記錄和審計：JWT 中包含的聲明信息可以用於日誌記錄和審計目的，以便跟蹤用戶活動和系統操作。
9. 移動設備和 IoT 設備的身份驗證：JWT 可用於驗證移動設備和 IoT 設備的身份，以確保只有受信任的設備能夠訪問系統。

# JWT 的優缺點

## 優點

- 自包含性：JWT 包含有關用戶或實體的信息，因此不需要在服務器端存儲會話狀態。這使得 JWT 非常適合無狀態應用程序和分佈式系統。
- 緊湊性：JWT 是緊湊的文本格式，易於在 HTTP 請求頭部或 URL 參數中傳遞。這降低了網路傳輸的開銷。
- 標準化：JWT 是一個開放標準，廣泛支持於各種編程語言和平臺，具有廣泛的互操作性。
- 安全性：JWT 支持數字簽名或加密，以確保令牌的完整性和真實性。只有持有正確密鑰的人才能生成有效的令牌。
- 靈活性：JWT 支持自定義聲明，可以包含各種有關用戶或實體的信息，適用於多種應用場景。
- 跨域通信：JWT 可以在不同域之間進行安全通信，因爲它可以輕鬆地在 HTTP 請求的頭部中傳遞。
- 無狀態性：JWT 使應用程序變得無狀態，這有助於提高可伸縮性和簡化架構。

## 缺點

- 不可撤銷性：一旦 JWT 生成並簽名，就不能撤銷或失效，除非等到令牌的過期時間。這在某些場景下可能不適用，例如，如果用戶需要立即註銷或更改權限。
- 令牌大小：JWT 的大小取決於包含的聲明和簽名算法，較大的 JWT 可能會增加網路傳輸的負擔。
- 密鑰管理：JWT 的安全性依賴於密鑰的管理，確保密鑰的保密性非常重要。泄漏密鑰可能導致令牌被僞造。
- 無法處理會話失效：JWT 通常用於短期認證，無法有效處理會話失效或長期持久的身份驗證需求。
- 不適用于敏感數據：JWT 不應該用於存儲敏感數據，因爲它只是簽名或加密，並不提供數據的機密性。對於敏感數據，應使用額外的加密措施。
- 需要額外的網路傳輸：每次請求都需要將 JWT 包含在請求中，這可能增加了一些額外的網路傳輸成本。

# 相關連結

- [JWT.io](https://jwt.io/)
- [JSON Web Token - Wikipedia](https://en.wikipedia.org/wiki/JSON_Web_Token)
